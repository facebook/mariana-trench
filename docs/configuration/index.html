<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mariana Trench RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mariana Trench Atom Feed"><title data-react-helmet="true">Configuration | Mariana Trench</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://mariana-tren.ch/docs/configuration/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Configuration | Mariana Trench"><meta data-react-helmet="true" name="description" content="Mariana Trench is highly configurable and we recommend that you invest time into adjusting the tool to your specific use cases. At Facebook, we have dedicated security engineers that will spend a significant amount of their time adding new rules and model generators to improve the analysis results."><meta data-react-helmet="true" property="og:description" content="Mariana Trench is highly configurable and we recommend that you invest time into adjusting the tool to your specific use cases. At Facebook, we have dedicated security engineers that will spend a significant amount of their time adding new rules and model generators to improve the analysis results."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://mariana-tren.ch/docs/configuration/"><link data-react-helmet="true" rel="alternate" href="https://mariana-tren.ch/docs/configuration/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://mariana-tren.ch/docs/configuration/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.a9e008ac.css">
<link rel="preload" href="/assets/js/runtime~main.e8d2ba91.js" as="script">
<link rel="preload" href="/assets/js/main.27daf25d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">Mariana Trench</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/overview/">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/mariana-trench" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">User Guide</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/overview/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/customize-sources-and-sinks/">Customize Sources and Sinks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/models/">Models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/configuration/">Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Developer Guide</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_1lV3"><div class="docItemContainer_zt2Y"><article><header><h1 class="docTitle_1y8q">Configuration</h1></header><div class="markdown"><p>Mariana Trench is highly configurable and we recommend that you invest time into adjusting the tool to your specific use cases. At Facebook, we have dedicated security engineers that will spend a significant amount of their time adding new rules and model generators to improve the analysis results.</p><p>This page will cover the more important, non-trivial configuration options. Note that you will spend most of your time configuring Mariana Trench writing model generators. These are covered in the <a href="/docs/models/">next section</a>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="command-line-options">Command Line Options<a aria-hidden="true" class="hash-link" href="#command-line-options" title="Direct link to heading">​</a></h2><p>You can get a full set of options by running <code>mariana-trench --help</code>. The following is an abbreviated version of the output.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ mariana-trench --help</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Target arguments:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --apk-path APK_PATH   The APK to analyze.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Output arguments:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --output-directory OUTPUT_DIRECTORY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        The directory to store results in.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Configuration arguments:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --system-jar-configuration-path SYSTEM_JAR_CONFIGURATION_PATH</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        A JSON configuration </span><span class="token function" style="color:rgb(130, 170, 255)">file</span><span class="token plain"> with a list of paths to the system jars.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --rules-paths RULES_PATHS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        A </span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token plain">-separated list of rules files and directories containing rules files.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --repository-root-directory REPOSITORY_ROOT_DIRECTORY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        The root of the repository. Resulting paths will be relative to this.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --source-root-directory SOURCE_ROOT_DIRECTORY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        The root where </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">source</span><span class="token plain"> files </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> the APK can be found.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --model-generator-configuration-paths MODEL_GENERATOR_CONFIGURATION_PATHS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        A </span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token plain">-separated list of paths specifying JSON configuration files. Each </span><span class="token function" style="color:rgb(130, 170, 255)">file</span><span class="token plain"> is a list of paths to JSON model generators relative to the</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        configuration </span><span class="token function" style="color:rgb(130, 170, 255)">file</span><span class="token plain"> or names of CPP model generators.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --model-generator-search-paths MODEL_GENERATOR_SEARCH_PATHS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        A </span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token plain">-separated list of paths where we </span><span class="token function" style="color:rgb(130, 170, 255)">look</span><span class="token plain"> up JSON model generators.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --maximum-source-sink-distance MAXIMUM_SOURCE_SINK_DISTANCE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        Limits the distance of sources and sinks from a trace entry point.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="--apk-path"><code>--apk-path</code><a aria-hidden="true" class="hash-link" href="#--apk-path" title="Direct link to heading">​</a></h4><p>Mariana Trench analyzes Dalvik bytecode. You provide it with the android app (APK) to analyze.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="--output-directory-output_directory"><code>--output-directory OUTPUT_DIRECTORY</code><a aria-hidden="true" class="hash-link" href="#--output-directory-output_directory" title="Direct link to heading">​</a></h4><p>The output of the analysis is a file containing metadata about the particular run in JSON format as well as sharded files containing data flow specifications for every method in the APK. These files need to be processed by SAPP (see <a href="/docs/getting-started/">Getting Started</a>) after the analysis. The flag specifies where these files are saved.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="--system-jar-configuration-path-system_jar_configuration_path"><code>--system-jar-configuration-path SYSTEM_JAR_CONFIGURATION_PATH</code><a aria-hidden="true" class="hash-link" href="#--system-jar-configuration-path-system_jar_configuration_path" title="Direct link to heading">​</a></h4><p>This path points to a json file containing a list of <code>.jar</code> files that the analysis should include in the analysis. It&#x27;s important that this contains at least the <code>android.jar</code> on your system. This file is typically located in your android SDK distribution at <code>$ANDROID_SDK/platforms/android-30/android.jar</code>. Without the <code>android.jar</code>, Mariana Trench will not know about many methods from the standard library that might be important for your model generators.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="--rules-paths-rules_paths"><code>--rules-paths RULES_PATHS</code><a aria-hidden="true" class="hash-link" href="#--rules-paths-rules_paths" title="Direct link to heading">​</a></h4><p>A <code>;</code> separated search path pointing to files and directories containing rules files. These files specify what taint flows Mariana Trench should look for. Check out the <a href="https://github.com/facebook/mariana-trench/blob/main/configuration/rules.json#L2-L13" target="_blank" rel="noopener noreferrer"><code>rules.json</code></a> that&#x27;s provided by default. It specifies that we want to find flows from user controlled input (<code>ActivityUserInput</code>) into <code>CodeExecution</code> sinks and that this constitutes a remote code execution.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="--source-root-directory-source_root_directory"><code>--source-root-directory SOURCE_ROOT_DIRECTORY</code><a aria-hidden="true" class="hash-link" href="#--source-root-directory-source_root_directory" title="Direct link to heading">​</a></h4><p>Mariana Trench will do a source indexing path before the analysis. This is because Dalvik/Java bytecode does not contain complete location information, only filenames (not paths) and line numbers. The index is later used to emit precise locations.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="--model-generator-configuration-paths-model_generator_configuration_paths"><code>--model-generator-configuration-paths MODEL_GENERATOR_CONFIGURATION_PATHS</code><a aria-hidden="true" class="hash-link" href="#--model-generator-configuration-paths-model_generator_configuration_paths" title="Direct link to heading">​</a></h4><p>A <code>;</code> separated set of files containing the names of model generators to run. See <a href="https://github.com/facebook/mariana-trench/blob/main/configuration/default_generator_config.json" target="_blank" rel="noopener noreferrer"><code>default_generator_config.json</code></a> for an example.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="--model-generator-search-paths-model_generator_search_paths"><code>--model-generator-search-paths MODEL_GENERATOR_SEARCH_PATHS</code><a aria-hidden="true" class="hash-link" href="#--model-generator-search-paths-model_generator_search_paths" title="Direct link to heading">​</a></h4><p>A <code>;</code> separated search path where Mariana Trench will try to find the model generators specified in the generator configuration.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="--maximum-source-sink-distance-maximum_source_sink_distance"><code>--maximum-source-sink-distance MAXIMUM_SOURCE_SINK_DISTANCE</code><a aria-hidden="true" class="hash-link" href="#--maximum-source-sink-distance-maximum_source_sink_distance" title="Direct link to heading">​</a></h4><p>For performance reasons it can be useful to limit the maximum length of a trace Mariana Trench tries to find (note that longer traces also tend to be harder to interpret). Due to the modular nature of the analysis the value specified here limits the maximum length from the trace root to the source, and from the trace root to the sink. This means found traces can have length of <code>2 x MAXIMUM_SOURCE_SINK_DISTANCE</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div></div><br><div class="row"><div class="col"><a href="https://github.com/facebook/mariana-trench/tree/main/documentation/website/documentation/configuration.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/models/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Models</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/contribution/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Contribution<!-- --> »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#command-line-options" class="table-of-contents__link toc-highlight">Command Line Options</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/fbOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/mariana-trench" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2021 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e8d2ba91.js"></script>
<script src="/assets/js/main.27daf25d.js"></script>
</body>
</html>