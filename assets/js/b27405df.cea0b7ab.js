"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2765],{20033(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>h});const a=JSON.parse('{"id":"getting-started","title":"Getting Started","description":"This guide will walk you through setting up Mariana Trench on your machine and get you to find your first remote code execution vulnerability in a small sample app.","source":"@site/documentation/getting_started.md","sourceDirName":".","slug":"/getting-started","permalink":"/docs/getting-started","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/mariana-trench/tree/main/documentation/website/documentation/getting_started.md","tags":[],"version":"current","frontMatter":{"id":"getting-started","title":"Getting Started","sidebar_label":"Getting Started"},"sidebar":"docs","previous":{"title":"Known False Negatives","permalink":"/docs/known-false-negatives"},"next":{"title":"Analysis Configuration Options","permalink":"/docs/configuration"}}');var i=t(74848),s=t(28453),r=t(86025);const o={id:"getting-started",title:"Getting Started",sidebar_label:"Getting Started"},c=void 0,l={},h=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installing Mariana Trench",id:"installing-mariana-trench",level:2},{value:"Running Mariana Trench",id:"running-mariana-trench",level:2},{value:"Post Processing",id:"post-processing",level:2},{value:"Exploring Results",id:"exploring-results",level:2},{value:"Configuring Mariana Trench",id:"configuring-mariana-trench",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This guide will walk you through setting up Mariana Trench on your machine and get you to find your first remote code execution vulnerability in a small sample app."}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.p,{children:["Mariana Trench requires a recent version of ",(0,i.jsx)(n.a,{href:"https://www.python.org/downloads/",children:"Python"}),". On MacOS you can get a current version through ",(0,i.jsx)(n.a,{href:"https://brew.sh/",children:"homebrew"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"$ brew install python3\n"})}),"\n",(0,i.jsxs)(n.p,{children:["On a Debian flavored Linux (Ubuntu, Mint, Debian), you can use ",(0,i.jsx)(n.code,{children:"apt-get"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"$ sudo apt-get install python3 python3-pip python3-venv\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This guide also assumes you have the ",(0,i.jsx)(n.a,{href:"https://developer.android.com/studio",children:"Android SDK"})," installed and an environment variable ",(0,i.jsx)(n.code,{children:"$ANDROID_SDK"})," pointed to the location of the SDK."]}),"\n",(0,i.jsxs)(n.p,{children:["For the rest of this guide, we assume that you are working inside of a ",(0,i.jsx)(n.a,{href:"https://docs.python.org/3/tutorial/venv.html",children:"virtual environment"}),". You can set this up with"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"$ python3 -m venv ~/.venvs/mariana-trench\n$ source ~/.venvs/mariana-trench/bin/activate\n(mariana-trench)$\n"})}),"\n",(0,i.jsx)(n.p,{children:"The name of the virtual environment in front of your shell prompt indicates that the virtual environment is active."}),"\n",(0,i.jsx)(n.h2,{id:"installing-mariana-trench",children:"Installing Mariana Trench"}),"\n",(0,i.jsx)(n.p,{children:"Inside your virtual environment installing Mariana Trench is as easy as running"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"(mariana-trench)$ pip install mariana-trench\n"})}),"\n",(0,i.jsx)(n.h2,{id:"running-mariana-trench",children:"Running Mariana Trench"}),"\n",(0,i.jsx)(n.p,{children:"We'll use a small app that is part of our documentation. You can get it by running"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"(mariana-trench)$ git clone https://github.com/facebook/mariana-trench\n(mariana-trench)$ cd mariana-trench/documentation/sample-app\n"})}),"\n",(0,i.jsx)(n.p,{children:"We are now ready to run the analysis"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"(mariana-trench)$ mariana-trench \\\n  --system-jar-configuration-path=configuration/default_system_jar_paths.json \\\n  --model-generator-configuration-paths=configuration/default_generator_config.json \\\n  --lifecycles-paths=configuration/lifecycles.json \\\n  --rules-paths=configuration/rules.json \\\n  --apk-path=documentation/sample-app/app/build/outputs/apk/debug/app-debug.apk \\\n  --source-root-directory=documentation/sample-app/app/src/main/java \\\n  --model-generator-search-paths=configuration/model-generators/\n\n# ...\nINFO Analyzed 68886 models in 4.04s. Found 4 issues!\n# ...\n"})}),"\n",(0,i.jsx)(n.p,{children:"The analysis has found 4 issues in our sample app. The output of the analysis is a set of specifications for each method of the application."}),"\n",(0,i.jsx)(n.h2,{id:"post-processing",children:"Post Processing"}),"\n",(0,i.jsxs)(n.p,{children:["The specifications themselves are not meant to be read by humans. We need an additional processing step in order to make the results more presentable. We do this with ",(0,i.jsx)(n.a,{href:"https://github.com/facebook/sapp",children:"SAPP"})," PyPi installed for us:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"(mariana-trench)$ sapp --tool=mariana-trench analyze .\n(mariana-trench)$ sapp --database-name=sapp.db server --source-directory=app/src/main/java\n# ...\n2021-05-12 12:27:22,867 [INFO]  * Running on http://localhost:13337/ (Press CTRL+C to quit)\n"})}),"\n",(0,i.jsx)(n.p,{children:"The last line of the output tells us that SAPP started a local webserver that lets us look at the results. Open the link and you will see the 4 issues found by the analysis."}),"\n",(0,i.jsx)(n.h2,{id:"exploring-results",children:"Exploring Results"}),"\n",(0,i.jsxs)(n.p,{children:["Let's focus on the remote code execution issue found in the sample app. You can identify it by its issue code ",(0,i.jsx)(n.code,{children:"1"})," (for all remote code executions) and the callable ",(0,i.jsx)(n.code,{children:"void MainActivity.onCreate(Bundle)"}),". With only 4 issues to see it's easy to identify the issue manually but once more rules run, the filter functionality at the top right of the page comes in handy."]}),"\n",(0,i.jsx)("img",{alt:"Single Issue Display",src:(0,r.default)("img/issue.png")}),"\n",(0,i.jsxs)(n.p,{children:["The issue tells you that Mariana Trench found a remote code execution in ",(0,i.jsx)(n.code,{children:"MainActivity.onCreate"})," where the data is coming from ",(0,i.jsx)(n.code,{children:"Activity.getIntent"})," one call away, and flows into the constructor of ",(0,i.jsx)(n.code,{children:"ProcessBuilder"}),' 3 calls away. Click on "Traces" in the top right corner of the issue to see an example trace.']}),"\n",(0,i.jsx)(n.p,{children:"The trace surfaced by Mariana Trench consists of three parts."}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.em,{children:"source trace"})," represents where the data is coming from. In our example, the trace is very short: ",(0,i.jsx)(n.code,{children:"Activity.getIntent"})," is called in ",(0,i.jsx)(n.code,{children:"MainActivity.onCreate"})," directly."]}),"\n",(0,i.jsx)("img",{alt:"Trace Source",src:(0,r.default)("img/trace_source.png")}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.em,{children:"trace root"})," represents where the source trace meets the sink trace. In our example this is the ",(0,i.jsx)(n.code,{children:"MainActivity.onCreate"})," method."]}),"\n",(0,i.jsx)("img",{alt:"Trace Root",src:(0,r.default)("img/trace_root.png")}),"\n",(0,i.jsxs)(n.p,{children:["The final part of the trace is the ",(0,i.jsx)(n.em,{children:"sink trace"}),": This is where the data from the source flows down into a sink. In our example from ",(0,i.jsx)(n.code,{children:"onCreate"}),", to ",(0,i.jsx)(n.code,{children:"onClick"}),", to ",(0,i.jsx)(n.code,{children:"execute"}),", and finally into the constructor of ",(0,i.jsx)(n.code,{children:"ProcessBuilder"}),"."]}),"\n",(0,i.jsx)("img",{alt:"Trace Source",src:(0,r.default)("img/trace_sink.png")}),"\n",(0,i.jsx)(n.h2,{id:"configuring-mariana-trench",children:"Configuring Mariana Trench"}),"\n",(0,i.jsxs)(n.p,{children:['You might be asking yourself, "how does the tool know what is user controlled data, and what is a sink?". This guide is meant to quickly get you started on a small app. We did not cover how to configure Mariana Trench. You can read more about that in the ',(0,i.jsx)(n.a,{href:"/docs/configuration",children:"Configuration section"}),"."]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453(e,n,t){t.d(n,{R:()=>r,x:()=>o});var a=t(96540);const i={},s=a.createContext(i);function r(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);